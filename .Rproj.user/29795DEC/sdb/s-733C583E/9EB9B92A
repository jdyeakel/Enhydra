{
    "contents" : "#Simulated consumer code\nlibrary(ellipse)\nlibrary(RColorBrewer)\n\n\n#Import prey data\nprey <- read.csv(\"Prey.csv\",header=TRUE)\nnprey <- length(prey[,1])\nellip_prey <- list(nprey); CI <- 0.95\n#build ellipses for prey\nfor (i in 1:nprey) {\n  #Sigma <- matrix(c(prey$CSD[i],0,0,prey$NSD[i]),2,2)\n  mu <- c(prey$CM[i],prey$NM[i])\n  ellip_prey[[i]] <- ellipse(x=0,scale = c(prey$CSD[i],prey$NSD[i]),centre=mu,level=CI)\n}\n\n#Number of consumers\nN = 200\n\n#Body size of consumers (kg)\nbmass <- rep(20,N)\n\n#Time-steps\nt_term <- 1000\n\n#Matrix for saving consumer C values\nc_m <- matrix(0,N,t_term)\n\n#Matrix for saving consumer N values\nn_m <- matrix(0,N,t_term)\n\n#Matrix cor saving consumer prey bouts\nd_m <- matrix(0,N,t_term)\n\n#Initial consumer isotope values\n#For now, the initial value will just be the means of the prey\nc_init <- rep(mean(prey$CM),N)\nn_init <- rep(mean(prey$NM),N)\n\nc_m[,1] <- c_init\nn_m[,1] <- n_init\n\n#0 indicates generalist; 1 indicates specialist\ne_gen <- rep(1,N)\n#Which prey item does each consumer specialize on?\ns_prey <- sample(nprey,N,replace=TRUE)\n\n#Loop over time\nfor (t in 1:(t_term-1)) {\n  \n  #Loop over consumers\n  for (i in 1:N) {\n    #Define the carbon, nitrogen isotope values of body at time t\n    cb <- c_m[i,t]\n    nb <- n_m[i,t]\n    \n    #Define body mass of consumer\n    mb <- bmass[i]\n    \n    #Determine next prey item\n    if (e_gen[i] == 0) {\n      #If generalist, randomly select from all prey\n      next_prey <- sample(nprey,1,replace=TRUE)\n    } else {\n      #If specialist, select it's preferred prey\n      next_prey <- s_prey[i]\n    }\n    \n    #Randomly draw prey isotope values from known mean and sd\n    cp_mean <- prey$CM[next_prey]\n    cp_sd <- prey$CSD[next_prey]\n    cp <- rnorm(1,cp_mean,cp_sd)\n    \n    np_mean <- prey$NM[next_prey]\n    np_sd <- prey$NSD[next_prey]\n    np <- rnorm(1,np_mean,np_sd)\n    \n    #weights for body size\n    f <- mb/(mb + 1)\n    \n    cb_next <- f*cb + (1-f)*cp\n    nb_next <- f*nb + (1-f)*np\n    \n    c_m[i,t+1] <- cb_next\n    n_m[i,t+1] <- nb_next\n    \n  } #end i\n  \n} #end t\n\n\ncolors <- brewer.pal(9,\"Set2\")\n\n#Plot prey ellipses\nplot(ellip_prey[[1]],type=\"l\",xlim=c(-22,-10),ylim=c(6,18),col=\"gray\")\nfor (i in 2:nprey) {\n  lines(ellip_prey[[i]],col=\"gray\")\n}\nfor (i in 1:N) {\nind <- i\npoints(c_m[ind,],n_m[ind,],pch=16,cex=0.25,col=colors[i])\nlines(c_m[ind,],n_m[ind,],pch=16,cex=0.25,col=colors[i])\n}\n",
    "created" : 1426278646737.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "848955761",
    "id" : "9EB9B92A",
    "lastKnownWriteTime" : 1426299614,
    "path" : "~/Dropbox/Enhydra/Tissue Project/consumer_sim.R",
    "project_path" : "consumer_sim.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_source"
}